language: php

git:
  depth: false

php:
  - 7.2
  - 7.3

cache:
  directories:
    - $HOME/.composer/cache

before_script:
  - echo | pecl install channel://pecl.php.net/yaml-2.0.4
  - find src/ -type f -name '*.php' | xargs -n 1 php -l
  - composer install --no-dev

script:
  - composer build

before_deploy:
  - scripts/before_deploy

deploy:
  provider: bintray
  user: ${BINTRAY_USER}
  key: ${BINTRAY_SECRET}
  skip_cleanup: true
  on:
    all_branches: true
    condition: $TRAVIS_PHP_VERSION = 7.2 && $TRAVIS_PULL_REQUEST = false && $TRAVIS_BRANCH =~ ^(master|1.13.2|1.14.4)$
  file: build/bintray.json
